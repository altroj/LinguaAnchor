<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Letter Memorization</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f4f9; }
        
        /* Header and Upload Styles */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .upload-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* The Learning Area */
        #text-container { 
            font-size: 24px; 
            line-height: 1.6; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 200px;
        }

        /* Word States */
        .word { display: inline-block; margin-right: 8px; padding: 2px 5px; border-radius: 4px; transition: all 0.2s; }
        
        /* Hidden state (User hasn't typed it yet) */
        .word.hidden { color: transparent; background-color: #e0e0e0; border-bottom: 2px solid #ccc; user-select: none; }
        
        /* Active state (The word the user needs to type now) */
        .word.active { color: transparent; background-color: #b3d4fc; border-bottom: 3px solid #007bff; position: relative; }
        /* Show the first letter hint for the active word */
        .word.active::after {
            content: attr(data-first-letter);
            color: #0056b3;
            position: absolute;
            left: 5px;
            top: 0;
        }

        /* Completed state */
        .word.completed { color: #333; background-color: transparent; border-bottom: none; }

        /* Instruction text */
        .instructions { color: #666; margin-bottom: 10px; font-style: italic; }
    </style>
</head>
<body>

    <header>
        <h1>Language Memorizer</h1>
    </header>

    <div class="upload-box">
        <p>Upload your own text (.md):</p>
        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="file" accept=".md">
            <button type="submit">Load Text</button>
        </form>
    </div>

    <hr>

    <p class="instructions">Type the <strong>first letter</strong> of the highlighted word to reveal it.</p>
    
    <div id="text-container"></div>

    <div id="raw-text" style="display:none;">{{ text_content }}</div>

    <script>
        const rawText = document.getElementById('raw-text').innerText;
        const container = document.getElementById('text-container');
        
        // 1. Prepare the text
        // We split by spaces to get words. 
        // Note: Ideally, we would strip newlines, but let's keep it simple.
        const words = rawText.trim().split(/\s+/);
        
        let currentWordIndex = 0;

        // 2. Render the words into the container
        words.forEach((word, index) => {
            const span = document.createElement('span');
            span.classList.add('word');
            
            // Default state: First word is active, others are hidden
            if (index === 0) {
                span.classList.add('active');
            } else {
                span.classList.add('hidden');
            }

            span.innerText = word;
            span.id = `word-${index}`;
            
            // Store the first letter cleanly (remove punctuation for the check if you want, 
            // but for now, we check the actual first character including quotes/etc)
            span.dataset.firstLetter = word.charAt(0);
            
            container.appendChild(span);
        });

        // 3. The Typing Logic
        document.addEventListener('keydown', (e) => {
            // Ignore non-character keys (shift, ctrl, etc)
            if (e.key.length > 1) return;

            // Get the current active word
            const currentWordSpan = document.getElementById(`word-${currentWordIndex}`);
            if (!currentWordSpan) return; // End of text

            const targetWord = words[currentWordIndex];
            const targetLetter = targetWord.charAt(0).toLowerCase();
            const typedLetter = e.key.toLowerCase();

            // Check if the typed letter matches the first letter of the word
            if (typedLetter === targetLetter) {
                // Correct!
                
                // 1. Mark current word as completed (reveal it)
                currentWordSpan.classList.remove('active');
                currentWordSpan.classList.remove('hidden');
                currentWordSpan.classList.add('completed');

                // 2. Move to next word
                currentWordIndex++;
                const nextWordSpan = document.getElementById(`word-${currentWordIndex}`);
                
                if (nextWordSpan) {
                    nextWordSpan.classList.remove('hidden');
                    nextWordSpan.classList.add('active');
                } else {
                    alert("Text completed! Great job.");
                }
            } else {
                // Optional: Add a shake animation or red flash here for incorrect input
                console.log("Incorrect letter.");
            }
        });
    </script>
</body>
</html>